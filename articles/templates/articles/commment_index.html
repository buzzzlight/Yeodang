{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block content %}
<div>
    <h5 class="my-3">댓글 ({{ comments|length }})</h5>
    {% if request.user.is_authenticated %}
    <form action="{% url 'articles:comment_create' article.pk %}" method="POST">
      {% csrf_token %}
      {% bootstrap_form comment_form %}
      <div class="d-flex justify-content-end">
        <input class="btn btn-sm btn-outline-primary" type="submit" value="등록">
      </div>
    </form>
    {% else %}
    <a href="{% url 'accounts:login' %}">[댓글을 작성하려면 로그인하세요.]</a>
    {% endif %}
  </div>
  <hr>
  {% for comment in comments %}
  <div class="mt-3 d-flex justify-content-between">
    <div>
      <p style="font-size: 0.7rem; margin-bottom: 0rem;">
        <a href="{% url 'accounts:detail' article.user.pk %}">{{ comment.user.username }}</a> | {{ comment.created_at|date:'Y-m-d H:i' }}
      </p>
      <p style="margin-bottom: 0rem;">{{ comment.content }}</p>
    </div>
    <div class="d-flex justify-content-end mt-2">
    {% if request.user.is_authenticated %}
      <a class="like-heart mt-2" href="{% url 'articles:comment_like' article.pk comment.pk %}">
      {% if request.user in comment.like_users.all %}
        <i class="bi bi-heart-fill"></i><span> {{ comment.like_users.count }}</span>
      {% else %}
        <i class="bi bi-heart"></i><span> {{ comment.like_users.count }}</span>
      {% endif %}
      </a>
    {% else %}
      <a href="#" class="btn btn-outline-primary">
        <i class="bi bi-heart"><span id="like-count"> {{ comment.like_users.count }}</span></i>
      </a>
    {% endif %}
    {% if user == comment.user %}
    <!-- 댓글 수정 버튼 -->
      <form action="{% url 'articles:comment_update' article.pk comment.pk %}" method="POST" enctype="multipart/form-data">
        <button class="btn btn-none border-0 p-0 me-2">
          <img src="{% static 'image/edit.png' %}" style="width: 20px">
        </button>
      </form>
    <!-- 댓글 삭제 버튼 -->
      <form action="{% url 'articles:comment_delete' article.pk comment.pk %}" method="POST" class="d-inline mt-1">
        {% csrf_token %}
        <button class="btn btn-none border-0 p-0" type="submit">
         <img src="{% static 'images/bin.png' %}" style="width: 24px">
        </button>
      </form>
    {% else %}
    {% endif %}
    </div>
  </div>
    {% empty %}
    <p>댓글이 아직 없어요.</p>
  {% endfor %}
{% endblock content %}